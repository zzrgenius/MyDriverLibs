/*******************************************************************************
* @file    stm8s_tim4.c
* @author  钟昊翰
* @version V1.0.0
* @date    2017-09-25
* @brief   该文件为stm8s定时器4配置源文件
*******************************************************************************/

/* Includes ------------------------------------------------------------------*/
#include"main.h"
#include"drive.h"
#include"stm8s_tim4.h"

/* 私有常量 ----------------------------------------------------------------- */
/* 私有类型 ------------------------------------------------------------------*/
/* 私有定义 ------------------------------------------------------------------*/
#define TIM4_PERIOD       249
/* 私有变量 ------------------------------------------------------------------*/
/* 私有函数 ------------------------------------------------------------------*/

/**
  *  输出参数:  
  *  功能说明:  滴答定时器, 1ms 定时中断
  *  注意事项:  定时器4的时钟源为 16MHz
  */
void f_SystickInit(void)
{
    TIM4_PSCR = 0x06;  /* TIM4_PRESCALER_64 */
    TIM4_ARR  = TIM4_PERIOD;
    
    TIM4_SR_bit.UIF = 0;   /* 清除溢出标志 */
    
    TIM4_IER_bit.UIE = 1;  /* 使能定时器4中断 */
    
    TIM4_CR1_bit.CEN = 1;  /* 启动定时器 */
}